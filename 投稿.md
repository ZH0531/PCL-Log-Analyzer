# Minecraft 日志分析工具

**投稿名称**：Minecraft 日志分析工具  
**作者**：ZH0531  
**GitHub 仓库**：[https://github.com/ZH0531/PCL-Log-Analyzer/](https://github.com/ZH0531/PCL-Log-Analyzer/)  
**主页 CDN 链接（阿里云）**：
```
https://pcl.log.zh8888.top/Custom.xaml
```

---

## 项目简介

Minecraft 日志分析工具（项目名称 PCL Log Analyzer，简称 PLA）是一个以 PowerShell 脚本为核心，PCL 自定义主页为入口的轻量化日志分析工具，完全本地分析，不会上传任何内容。

也就是说，与很大一部分自定义主页不同的是，PLA 并不是聚焦于对自定义主页内容的更新，而是聚焦于对脚本的更新和创作，只不过会依赖 PCL2 生态。

## 开发初衷

项目的思路来源于内群的一份数万行的崩溃日志，仔细分析后发现，日志里包含了太多的无用堆栈信息、重复报错数百次等等... 这导致日志变得十分繁琐和庞大，百万 Tokens 的日志也很难被 AI 读完并且给出有效建议...

![image](https://github.com/user-attachments/assets/34d2e4ef-ad3a-41b5-8f5d-1bdbc4134fa3)

所以我在想，有没有一款针对 Minecraft 的日志分析工具或者 Mod，能够将这份数十万字的日志剔除无用信息，只保留关键错误呢？

经过寻找，找到了一款在线网站，只不过不知道为什么，上传之后卡住半天不动，更别谈拿到分析结果了...

于是我决定开发一款日志分析工具，最开始的时候想过很多种方式，例如做一个网站分析，或者开发一款 Mod 来收集并过滤最后追加到日志或新建一份总结日志，亦或者是修改 PCL 源码在百宝箱加一个日志分析的按钮...

在研究百宝箱的时候，意外注意到了PCL自定义主页，经过研究决定选用 PCL自定义主页+PowerShell 脚本来实现。
因为这是最方便分发、更新、以及使用的方式。

本工具的设计初衷是帮助更多小白玩家、看不懂日志的玩家、以及看得懂但是会被庞大的无效日志干扰的玩家。
所以我需要让工具能够做到傻瓜式操作、简单易懂的可视化分析、高效的版本更新分发机制。

<img width="1720" height="1014" alt="image" src="https://github.com/user-attachments/assets/a7504d3e-8eb4-4d7e-9e5f-1fd3b6127d91" />

## 技术实现

### 核心机制

工具的核心是利用按钮的 `EventType="打开文件"` 和 `EventData` 属性来启动 PowerShell 并且执行脚本。

PCL2 的自定义主页只会获取一个 XAML 文件和一个版本号文件，对于本工具来说是远远不够的...
不过幸好，`EventData` 可以打开应用程序...于是有了以下下载/更新工具命令：

```xaml
EventData="powershell.exe|-ExecutionPolicy Bypass -Command &quot;Set-Location '{path}PCL'; $ProgressPreference='SilentlyContinue'; $temp=[IO.Path]::Combine($env:TEMP,'PCL-Install.ps1'); Invoke-WebRequest -Uri 'https://pcl.log.zh8888.top/Install.ps1' -OutFile $temp -UseBasicParsing -Headers @{'Referer'='http://install.pcl2.server/';'User-Agent'='PCL2/InstallScript'}; &amp; $temp&quot;"
```

大概意思就是通过 PowerShell 从网络上下载一个[安装/更新脚本](https://github.com/ZH0531/PCL-Log-Analyzer/blob/main/Install.ps1)并立即执行...
我知道这听起来好像风险很高，但是我也没办法...因为自定义主页没法实现二次确认提示，况且要面向小白，就得做到自动化、一键完成。不过大家放心，本项目所有代码完全开源（包括开发专用脚本）。

其实本来这条命令可以短一点的，但是由于 PowerShell 对中文的支持真的一言难尽...哪怕在命令里设置了编码最后运行也会报错...以及在设置Referer和UA之后，我发现PCL主页能正常访问，但是我自己的脚本被拦截了...无奈只能这样。

### 更新机制

该安装/更新脚本会从CDN下载[`PLA.version`](https://github.com/ZH0531/PCL-Log-Analyzer/blob/main/PCL%20Log%20Analyzer/PLA.version)文件与本地版本文件进行匹配，优先检测工具版本号（与PCL主页更新机制类似），若本地版本号与远程不同才会下载更新[工具包](https://github.com/ZH0531/PCL-Log-Analyzer/tree/main/PCL%20Log%20Analyzer)，亦或者本地文件损坏也会重新下载（容错±1kb），至于怎么检测损坏，[开发区打包脚本](https://github.com/ZH0531/PCL-Log-Analyzer/blob/main/Package.ps1)会自动在版本文件写入每个文件对应的字节大小。

**安装示例输出：**

```
=========================================
  PCL Log Analyzer - 安装向导
=========================================

[1/7] 环境检查...
  + PowerShell: 5.1 (Windows PowerShell)
  ✓ 编码: UTF-8

[2/7] 检测安装位置...
  ✓ PCL 根目录: D:\Desktop\Games\PCL

[3/7] 检查版本...
  远程版本: 1.2.1
  本地版本:  1.2.0
  ✓ 发现更新: 1.2.0 -> 1.2.1

[4/7] 下载安装包...
  URL: https://pcl.log.zh8888.top/PCL%20Log%20Analyzer.zip
  ██████████████████████████████████████████████████ 100% (41.4 KB / 41.4 KB)
  ✓ 下载完成: 41.4 KB

[5/7] 安装文件...
  检测到旧版本，正在备份...
  ✓ 已解压到: D:\Desktop\Games\PCL\PCL Log Analyzer
  ✓ 正在迁移历史报告...
    已迁移 10 个报告

[6/7] 验证安装...
  ✓ Scripts\AnalyzeLogs.ps1
  ✓ Scripts\LogParser.ps1
  ✓ Scripts\ReportGenerator.ps1
  ✓ Scripts\GenerateReportsList.ps1
  ✓ Scripts\SelectLog.ps1
  ✓ Scripts\OpenReport.vbs
  ✓ Scripts\ClearReports.vbs
  ✓ Templates\report-template.html
  ✓ Templates\reports-list-template.html
  ✓ Rules\Rules.json
  ✓ Rules\README.md
  ✓ PLA.version

[7/7] 完成安装...
  ✓ 脚本编码已配置为 UTF-8 with BOM
  ✓ 所有组件就绪

=========================================
  ✓ 安装完成！
=========================================

现在您可以:
  ✓ 点击【分析最新日志】开始使用
  ✓ 点击【手动选择日志】进行自定义分析

窗口将在 5 秒后关闭...
```

### 分析流程

日志分析主脚本会自动从PCL的启动脚本找到最近一次的游戏目录并识别日志文件（一般为latest.log）以及崩溃报告文件（crash...xxx.txt），并调用其他的脚本（如解析日志脚本、HTML报告生成脚本、历史报告列表生成脚本）来自动解析、去重、匹配错误、生成建议并使用默认浏览器打开。

**分析示例输出：**

```
═══════════════════════════════════════
  PCL 日志分析工具 v1.2.1
═══════════════════════════════════════

[步骤 1/5] 查找最近一次游戏版本...
  找到: 1.21.1-Fabric 0.17.3
  路径: D:\Desktop\Games\PCL\.minecraft\versions\1.21.1-Fabric 0.17.3

[步骤 2/5] 定位日志文件...
  日志: ...\latest.log
  大小: 0.04 MB

[步骤 3/5] 分析日志...
    正在解析日志文件...
    自动找到最新崩溃报告：crash-2025-11-07_15.05.47-client.txt
  + 发现崩溃报告：crash-2025-11-07_15.05.47-client.txt
    正在从崩溃报告提取系统信息...
  ✓ 系统信息已从崩溃报告提取
  ✓ 日志解析完成

  游戏: 1.21.1
  加载器: Fabric 0.17.3
  Mod数: 107
  Java: 21.0.8
  内存: 4.8 GB (4915 MB)
  GPU: NVIDIA GeForce RTX 3050 Laptop GPU
  OpenGL: 3.2.0 NVIDIA 565.90
  CPU: 16 x AMD Ryzen 7 5800H with Radeon Graphics
  系统: Windows 11
  状态: Crashed
  错误数: 1

[步骤 4/5] 生成报告...
    正在生成 HTML 报告...
  ✓ 报告生成完成

  报告: 251107-150614-latest.log.html
  状态: 游戏崩溃
  错误: 1 个
  建议: 1 条

[步骤 5/5] 生成历史报告列表...
    正在更新历史报告索引...
  正在生成历史报告列表...
  ✓ 历史报告列表已生成: reports-list.html
  ✓ 历史报告列表已更新

✓ 分析完成！正在打开报告...
  [调试] 尝试读取系统默认浏览器...
  [调试] 找到 ProgId: MSEdgeHTM
  [调试] 浏览器路径: C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe
  ✓ 使用系统默认浏览器打开

窗口将在 5 秒后自动关闭...
  5...  4...  3...  2...  1...
```

## 功能展示

### 分析报告

生成的分析报告如下（示例，后续可能会更新）：

![分析报告示例1](https://github.com/user-attachments/assets/35a608b6-b5e8-468e-97a5-1efc82567fb7)
![分析报告示例2](https://github.com/user-attachments/assets/854654a5-db2c-4420-8426-d8517e438ec8)

### 历史报告

历史报告页面如下：

![历史报告页面](https://github.com/user-attachments/assets/1f27309b-e8fc-4e07-9e51-3b290271d134)

### VBScript 集成

值得一提的是，由于PCL的按钮打开文件使用的是默认方式打开，打开网页不支持`file:///`格式，会导致可能会有开发者通过VSCode打开分析报告...所以这里用的是轻量级的[vbs脚本](https://github.com/ZH0531/PCL-Log-Analyzer/blob/main/PCL%20Log%20Analyzer/Scripts/OpenReport.vbs)打开上次报告、历史报告以及一键删除历史报告也用到了[vbs脚本](https://github.com/ZH0531/PCL-Log-Analyzer/blob/main/PCL%20Log%20Analyzer/Scripts/ClearReports.vbs)
由于 PCL 自定义主页没法完成复杂操作...导致二次确认提示框只能用脚本的（我真的努力过了试了各种方法，vbs一用中文就报错，无奈只能英文，有解决办法的可以去仓库提交 issue）

![清空报告确认](https://github.com/user-attachments/assets/9ffbbfe8-70f8-466e-818b-ea48f595c2cf)

## 规则库说明

另外需要说明的是，工具目前对常见的崩溃（如 Mod 版本不匹配）等做了单独的处理，会显示具体mod名称和需要的版本，其他报错也尽量自动提取mod名称，剩余的全部会进入[JSON规则库](https://github.com/ZH0531/PCL-Log-Analyzer/tree/main/PCL%20Log%20Analyzer/Rules)。

由于 Mod 的存在，Minecraft 错误日志有很多种，甚至不同 Mod 加载器生成的日志也不一样，这也导致 PCL2 本身的崩溃日志识别没办法识别所有的错误（只是用一些简单的 Contains 匹配），也不会把庞大繁杂需要不断更新的规则库加入源码...这很不利于分发，维护也比较麻烦...

目前规则库只有不到一百条错误规则...所以我需要大量错误日志来完善规则库，如果你在使用本工具的时候，遇到了识别不准确、未识别、或脚本错误、不兼容等等问题的时候，欢迎提交issue。

如果你有能力，也欢迎通过提交PR来完善此[规则库](https://github.com/ZH0531/PCL-Log-Analyzer/tree/main/PCL%20Log%20Analyzer/Rules)。

### 关于 AI 集成

或许有人会想，现在AI工具那么发达为什么还要手动维护规则库...？其实我也想过这个问题，甚至想过可以通过填写秘钥存储到本地然后发起 Curl 给 DS，在系统提示词限定回复规则然后解析结果，技术上是可以做到的，但是这对小白来说增加了更多的麻烦...

更简单的方法是，你可以直接复制过滤后的日志发给 AI 来获取更准确的结果，但是工具本身也需要对日志进行通用识别。

## 环境要求与部署

工具对环境有一定要求，只支持 Win10 及以上版本，因为 Win7 的 PowerShell 版本太旧了我也不知道能不能运行...

并不是我要把这么多介绍全部放在讨论区，而是因为本工具会用到本地的脚本，这些同属于客户端的内容，也需要经过大家的评定...所以理应简单介绍一番。

另外该主页链接（[https://pcl.log.zh8888.top/Custom.xaml](https://pcl.log.zh8888.top/Custom.xaml)）采用的是阿里云OSS+CDN分发，有一键打包上传刷新CDN缓存脚本，更新还是比较方便的。

以及经过了#5023 的工具检查如下：

<img width="300" alt="image" src="https://github.com/user-attachments/assets/ef8a169c-b96f-45b4-aa17-bc1d9c34edb8" />
