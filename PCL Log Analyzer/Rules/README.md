# PCL Log Analyzer 规则库说明

## 📄 文件说明

- `Rules.json` - 错误识别规则库（包含错误规则、原因检测、解决建议）

## 📖 规则结构说明

### 基本字段

```json
{
  "id": "唯一标识符",
  "name": "错误名称（显示给用户）",
  "pattern": "正则表达式（用于匹配日志行）",
  "severity": "严重程度：严重|中等|轻微",
  "priority": "优先级（数字越小越优先，1-99）",
  "collectDetails": "是否收集详细信息（true/false）",
  "suggestion": "解决建议（针对主错误）"
}
```

### 带原因检测的规则

如果一个错误可能有多种原因（如Mod加载失败），可以添加 `causedBy` 字段：

```json
{
  "id": "mod_load_failed",
  "name": "Mod加载失败",
  "pattern": "Failed to create mod instance\\. ModID: ([a-zA-Z0-9_\\-]+)",
  "severity": "严重",
  "priority": 7,
  "suggestion": "Mod加载时失败。检查Mod文件是否完整...",
  "causedBy": [
    {
      "pattern": "MalformedJsonException",
      "reason": "配置文件格式错误",
      "suggestion": "该Mod的配置文件JSON格式不正确..."
    },
    {
      "pattern": "ClassNotFoundException",
      "reason": "类文件缺失",
      "suggestion": "Mod缺少必需的Java类文件..."
    }
  ]
}
```

## 🎯 优先级分配建议

| 范围 | 用途 | 示例 |
|------|------|------|
| 1-9 | 根本原因（最高优先级） | Mod环境冲突、依赖问题 |
| 10-29 | 直接错误 | Mod加载失败、初始化失败 |
| 30-39 | 连带错误 | 游戏崩溃、Mod状态异常 |
| 40-59 | 次要问题 | 资源加载失败、配置缺失 |
| 60-98 | 轻微问题 | 动画解析失败、内部警告 |
| 99 | 未分类错误 | 兜底规则 |

## 📝 如何添加新规则？

### 1. 添加简单规则

在 `errors` 数组中添加新对象：

```json
{
  "id": "your_error_id",
  "name": "你的错误名称",
  "pattern": "正则表达式",
  "severity": "严重",
  "priority": 20,
  "suggestion": "解决建议文字"
}
```

### 2. 添加带原因检测的规则

```json
{
  "id": "complex_error",
  "name": "复杂错误",
  "pattern": "主错误的正则表达式",
  "severity": "严重",
  "priority": 10,
  "suggestion": "通用建议",
  "causedBy": [
    {
      "pattern": "原因1的正则表达式",
      "reason": "原因1名称",
      "suggestion": "针对原因1的具体建议"
    },
    {
      "pattern": "原因2的正则表达式",
      "reason": "原因2名称",
      "suggestion": "针对原因2的具体建议"
    }
  ]
}
```

## 🔤 正则表达式说明

### 需要转义的特殊字符

在JSON中，以下字符需要使用 `\\` 转义：

| 字符 | 转义写法 | 示例 |
|------|---------|------|
| `.` | `\\.` | `Failed\\.` 匹配 "Failed." |
| `[` | `\\[` | `\\[ERROR\\]` 匹配 "[ERROR]" |
| `]` | `\\]` | 同上 |
| `(` | `\\(` | `\\(message\\)` 匹配 "(message)" |
| `)` | `\\)` | 同上 |
| `*` | `\\*` | `test\\*` 匹配 "test*" |
| `+` | `\\+` | `version\\+` 匹配 "version+" |
| `?` | `\\?` | `error\\?` 匹配 "error?" |
| `|` | `\\|` | 仅在字符类外需要 |

### 捕获组

使用 `()` 捕获需要的信息：

```json
"pattern": "ModID: ([a-zA-Z0-9_\\-]+)"
```

这会捕获Mod ID，并添加到 Details 中。

### 常用正则模式

```regex
\\d+          # 匹配数字
\\w+          # 匹配字母数字下划线
\\S+          # 匹配非空白字符
[a-zA-Z0-9]   # 匹配字母和数字
.*            # 匹配任意字符（贪婪）
.*?           # 匹配任意字符（非贪婪）
```

## 💡 建议编写技巧

### 好的建议应该包含：

1. **问题说明**：简洁描述问题是什么
2. **可能原因**：如果不是显而易见的
3. **具体步骤**：告诉用户怎么做
4. **预期结果**：解决后会怎样

### 示例：

```
❌ 不好的建议：
"Mod加载失败，请检查"

✅ 好的建议：
"Mod加载时失败。检查Mod文件是否完整、版本是否与游戏版本兼容。
如果下方显示了具体原因（如配置文件错误），请优先解决该原因"
```

## 🧪 测试规则

修改规则后，可以使用已知的错误日志测试：

1. 修改 `Rules.json`
2. 运行 PCL Log Analyzer 分析日志
3. 检查错误是否被正确识别
4. 检查建议是否显示正确

## 📮 反馈与贡献

如果发现：
- 常见错误未被识别
- 建议不够准确
- 规则误判

欢迎反馈或提交改进建议！

---

**最后更新**: 2025-11-08  
**版本**: 1.2.1

